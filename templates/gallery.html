{% extends "base.html" %}
{% block content %}

<h2 class="text-3xl font-bold mb-6">Gallery</h2>

{% if is_admin %}
<button
  onclick="openGalleryModal()"
  class="mb-6 bg-green-600 hover:bg-green-500 px-4 py-2 rounded">
  + Add Gallery Item
</button>
{% endif %}


<!-- CATEGORY PILLS -->
<div class="flex flex-wrap gap-2 mb-6">
  {% for category in gallery.keys() %}
    {% set cat_id = category|lower|replace(' ', '-') %}
    <button
      class="category-pill bg-gray-700 hover:bg-gray-600 px-4 py-1 rounded text-sm"
      onclick="scrollToCategory('{{ cat_id }}')">
      {{ category }}
    </button>
  {% endfor %}
</div>

{% for category, items in gallery.items() %}
  {% set cat_id = category|lower|replace(' ', '-') %}

  <!-- CATEGORY SECTION -->
  <div id="cat-{{ cat_id }}" class="mb-10">

    <!-- HEADER -->
    <div
      class="flex justify-between items-center cursor-pointer mb-4"
      onclick="toggleCategory('{{ cat_id }}')">

      <h3 class="text-xl font-semibold uppercase tracking-wide">
        {{ category }}
      </h3>

      <span
        id="icon-{{ cat_id }}"
        class="text-gray-400 transition-transform duration-300">
        ▼
      </span>

    </div>

    <!-- COLLAPSIBLE WRAPPER (NOT GRID) -->
    <div
      id="section-{{ cat_id }}"
      class="gallery-section expanded overflow-hidden transition-all duration-300 ease-in-out">

      <!-- GRID (INSIDE WRAPPER) -->
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">

        {% for g in items %}
          <div
            class="gallery-item bg-gray-800 rounded shadow relative overflow-hidden cursor-pointer"
            data-id="{{ g[0] }}"
            data-name="{{ g[1] }}">


            <img
              src="{{ g[3] }}"
              alt="{{ g[1] }}"
              class="w-full h-48 object-cover">

            <div class="p-4">
              <div class="font-semibold">{{ g[1] }}</div>

              {% if g[5] %}
                <div class="text-green-400 text-sm mt-1">
                  ₱{{ "%.2f"|format(g[4]) }}
                </div>
              {% endif %}
            </div>

            <!-- ADMIN ONLY -->
             
            {% if is_admin %}
            <button
              class="edit-gallery-btn absolute top-2 right-16 bg-blue-600 hover:bg-blue-500 text-xs px-2 py-1 rounded"
              data-id="{{ g[0] }}"
              data-name="{{ g[1] }}"
              data-category="{{ g[2] }}"
              data-price="{{ g[4] }}"
              data-show-price="{{ g[5] }}">
              Edit
            </button>



              <button
                data-id="{{ g[0] }}"
                onclick="deleteGallery(this)"
                class="absolute top-2 right-2 bg-red-600 hover:bg-red-500 text-xs px-2 py-1 rounded">
                Delete
              </button>
            {% endif %}

          </div>
        {% endfor %}

      </div>
    </div>
  </div>
{% endfor %}

{% if is_admin %}
<div
  id="galleryModal"
  class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">

  <div class="bg-gray-900 p-6 rounded w-full max-w-md">
    <h3 class="text-xl font-semibold mb-4">Add Gallery Item</h3>

    <form id="galleryForm" enctype="multipart/form-data">
      <div class="mb-3">
        <label class="block text-sm mb-1">Name</label>
        <input
          name="name"
          required
          class="w-full px-3 py-2 bg-gray-800 rounded">
      </div>

      <div class="mb-3">
        <label class="block text-sm mb-1">Category</label>
        <input
          name="category"
          class="w-full px-3 py-2 bg-gray-800 rounded">
      </div>

      <div class="mb-3">
        <label class="block text-sm mb-1">Price (optional)</label>
        <input
          name="price"
          type="number"
          step="0.01"
          class="w-full px-3 py-2 bg-gray-800 rounded">
      </div>

      <div class="mb-3 flex items-center gap-2">
        <input type="checkbox" name="show_price" value="1">
        <span class="text-sm">Show price</span>
      </div>

      <div class="mb-4">
        <label class="block text-sm mb-1">Image</label>

        <input
          type="file"
          name="image"
          accept="image/*"
          required
          onchange="previewGalleryImage(event)"
        >

        <img
          id="galleryPreview"
          class="mt-3 hidden w-full h-40 object-cover rounded border border-gray-700"
        >
      </div>


      <div class="flex justify-end gap-2">
        <button
          type="button"
          onclick="closeGalleryModal()"
          class="bg-gray-700 px-4 py-2 rounded">
          Cancel
        </button>
        <button
          type="submit"
          class="bg-green-600 px-4 py-2 rounded">
          Save
        </button>
      </div>
    </form>
  </div>
</div>
{% endif %}

{% if is_admin %}
<div
  id="editGalleryModal"
  class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">

  <div class="bg-gray-900 p-6 rounded w-full max-w-md">
    <h3 class="text-xl font-semibold mb-4">Edit Gallery Item</h3>

    <form id="editGalleryForm">
      <input type="hidden" name="id">

      <div class="mb-3">
        <label class="block text-sm mb-1">Name</label>
        <input name="name" class="w-full px-3 py-2 bg-gray-800 rounded">
      </div>

      <div class="mb-3">
        <label class="block text-sm mb-1">Category</label>
        <input name="category" class="w-full px-3 py-2 bg-gray-800 rounded">
      </div>

      <div class="mb-3">
        <label class="block text-sm mb-1">Price</label>
        <input name="price" type="number" step="0.01"
               class="w-full px-3 py-2 bg-gray-800 rounded">
      </div>

      <div class="mb-3 flex items-center gap-2">
        <input type="checkbox" name="show_price">
        <span class="text-sm">Show price</span>
      </div>

      <div class="flex justify-end gap-2">
        <button type="button" onclick="closeEditGallery()"
                class="bg-gray-700 px-4 py-2 rounded">Cancel</button>
        <button type="submit"
                class="bg-blue-600 px-4 py-2 rounded">Save</button>
      </div>
    </form>
  </div>
</div>
{% endif %}

<div
  id="designCollectionModal"
  class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50">

  <div class="bg-gray-900 p-6 rounded w-full max-w-4xl max-h-[90vh] overflow-y-auto">
    <div class="flex justify-between items-center mb-4">
      <h3 id="designTitle" class="text-xl font-semibold"></h3>
      <button onclick="closeDesignCollection()">✕</button>
    </div>

    <div
      id="designGrid"
      class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
    </div>

    {% if is_admin %}
    <hr class="my-6 border-gray-700">
    {% if is_admin %}
    <button
      id="addDesignBtn"
      class="bg-green-600 px-4 py-2 rounded mt-4 hidden">
      + Add Design
    </button>
{% endif %}

    {% endif %}
  </div>
</div>

{% if is_admin %}
<div
  id="addDesignModal"
  class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50">

  <div class="bg-gray-900 p-6 rounded w-full max-w-md">
    <h3 class="text-xl font-semibold mb-4">Add Design</h3>

    <form id="addDesignForm" enctype="multipart/form-data">
      <input type="hidden" name="gallery_id" id="designGalleryId">

      <div class="mb-3">
        <label class="block text-sm mb-1">Design Name</label>
        <input
          name="name"
          required
          class="w-full px-3 py-2 bg-gray-800 rounded">
      </div>

      <div class="mb-3">
        <label class="block text-sm mb-1">Laser Settings (Admin only)</label>
        <div class="mb-3">
        <label class="block text-sm mb-1">Font (for text)</label>
        <input
          name="font"
          placeholder="e.g. Montserrat"
          class="w-full px-3 py-2 bg-gray-800 rounded">
      </div>

      <div class="mb-3 grid grid-cols-2 gap-3">
        <div>
          <label class="block text-sm mb-1">Power (%)</label>
          <input
            name="power"
            type="number"
            min="1"
            max="100"
            required
            class="w-full px-3 py-2 bg-gray-800 rounded">
        </div>

        <div class="mb-3">
          <label class="block text-sm mb-1">Laser Time (minutes)</label>
          <input
            name="laser_time"
            type="number"
            min="1"
            step="1"
            required
            placeholder="e.g. 5"
            class="w-full px-3 py-2 bg-gray-800 rounded">
        </div>

        <div>
          <label class="block text-sm mb-1">Passes</label>
          <input
            name="passes"
            type="number"
            min="1"
            required
            class="w-full px-3 py-2 bg-gray-800 rounded">
        </div>
      </div>

      <div class="mb-3 grid grid-cols-2 gap-3">
        <div>
          <label class="block text-sm mb-1">Speed (mm/s)</label>
          <input
            name="speed"
            type="number"
            placeholder="Leave blank if using depth"
            class="w-full px-3 py-2 bg-gray-800 rounded">
        </div>

        <div>
          <label class="block text-sm mb-1">Depth (%)</label>
          <input
            name="depth"
            type="number"
            placeholder="Optional"
            class="w-full px-3 py-2 bg-gray-800 rounded">
        </div>
      </div>

      </div>

      <div class="mb-3">
        <label class="block text-sm mb-1">Design Image</label>
        <input
          type="file"
          name="image"
          accept="image/*"
          required
          onchange="previewDesignImage(event)">
        <img
          id="designPreview"
          class="hidden mt-3 w-full h-40 object-cover rounded">
      </div>

      <div class="flex justify-end gap-2">
        <button
          type="button"
          onclick="closeAddDesignModal()"
          class="bg-gray-700 px-4 py-2 rounded">
          Cancel
        </button>
        <button
          type="submit"
          class="bg-green-600 px-4 py-2 rounded">
          Save
        </button>
      </div>
    </form>
  </div>
</div>
{% endif %}

{% if is_admin %}
<div
  id="editDesignModal"
  class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50">

  <div class="bg-gray-900 p-6 rounded w-full max-w-md">
    <h3 class="text-xl font-semibold mb-4">Edit Design</h3>

    <form id="editDesignForm" enctype="multipart/form-data">
      <input type="hidden" name="id">

      <div class="mb-3">
        <label class="block text-sm mb-1">Design Name</label>
        <input name="name" required class="w-full px-3 py-2 bg-gray-800 rounded">
      </div>

      <div class="mb-3">
        <label class="block text-sm mb-1">Font</label>
        <input name="font" class="w-full px-3 py-2 bg-gray-800 rounded">
      </div>

      <div class="grid grid-cols-2 gap-3 mb-3">
        <div>
          <label class="block text-sm mb-1">Power (%)</label>
          <input name="power" type="number" required class="w-full px-3 py-2 bg-gray-800 rounded">
        </div>
        <div class="mb-3">
        <label class="block text-sm mb-1">Laser Time (minutes)</label>
        <input
          name="laser_time"
          type="number"
          min="1"
          step="1"
          required
          class="w-full px-3 py-2 bg-gray-800 rounded">
      </div>


        <div>
          <label class="block text-sm mb-1">Passes</label>
          <input name="passes" type="number" required class="w-full px-3 py-2 bg-gray-800 rounded">
        </div>
      </div>

      <div class="grid grid-cols-2 gap-3 mb-3">
        <input name="speed" placeholder="Speed (mm/s)" class="w-full px-3 py-2 bg-gray-800 rounded">
        <input name="depth" placeholder="Depth (%)" class="w-full px-3 py-2 bg-gray-800 rounded">
      </div>

      <div class="mb-3">
        <label class="block text-sm mb-1">Replace Image (optional)</label>
        <input type="file" name="image" accept="image/*">
      </div>

      <div class="flex justify-end gap-2">
        <button type="button" onclick="closeEditDesignModal()" class="bg-gray-700 px-4 py-2 rounded">
          Cancel
        </button>
        <button type="submit" class="bg-blue-600 px-4 py-2 rounded">
          Save
        </button>
      </div>
    </form>
  </div>
</div>
{% endif %}


<script src="{{ url_for('static', filename='js/gallery.js') }}"></script>
{% endblock %}
